<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Análise de Fluxo de Caixa - Donos do Negócio</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <style>
        .fluxo-caixa {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .form-section {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input[type="number"], input[type="text"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        .btn-gerar {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            display: block;
            margin: 30px auto;
            transition: background-color 0.3s;
        }
        
        .btn-gerar:hover {
            background-color: #219653;
        }
        
        .preview-section {
            margin-top: 40px;
            border-top: 1px solid #eee;
            padding-top: 30px;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 30px;
        }
        
        .resultados {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .resultado-card {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .resultado-card h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        
        .resultado-valor {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .positivo {
            color: #27ae60;
        }
        
        .negativo {
            color: #e74c3c;
        }
        
        @media (max-width: 768px) {
            .form-grid, .resultados {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#2a5298">
</head>
<body>
    <header>
        <h1>DONOS DO NEGÓCIO</h1>
    </header>
    
    <div class="container">
        <nav class="menu-lateral">
            <div class="opcao"><a href="../index.html">INÍCIO</a></div>
            <div class="opcao"><a href="../artigos/artigo1.html">ARTIGOS</a></div>
            <div class="opcao"><a href="../Download/Download.html">DOWNLOAD</a></div>
            <div class="opcao"><a href="../calculadora/calculadora.html">CALCULADORA</a></div>
            <div class="opcao"><a href="../logo/logo.html">CRIE SUA LOGO</a></div>
            <div class="opcao"><a href="fluxodecaixa/analisefluxocaixa.html"> Analise seu fluxo de caixa
             </a></div>
        </nav>
        
        <main class="conteudo">
            <div class="fluxo-caixa">
                <h2>ANÁLISE DE FLUXO DE CAIXA</h2>
                <p>Preencha os dados abaixo para gerar um relatório completo sobre a saúde financeira do seu negócio.</p>
                
                <div class="form-section">
                    <h3>INFORMAÇÕES DA EMPRESA</h3>
                    <div class="form-group">
                        <label for="nome-empresa">NOME DA EMPRESA:</label>
                        <input type="text" id="nome-empresa" placeholder="Ex: Padaria Estrela">
                    </div>
                    
                    <div class="form-group">
                        <label for="periodo-analise">PERÍODO DE ANÁLISE (MESES):</label>
                        <input type="number" id="periodo-analise" min="1" max="12" value="3">
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>RECEITAS</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="receita-vendas">RECEITA DE VENDAS (R$):</label>
                            <input type="number" id="receita-vendas" placeholder="0.00" step="0.01">
                        </div>
                        
                        <div class="form-group">
                            <label for="receita-servicos">RECEITA DE SERVIÇOS (R$):</label>
                            <input type="number" id="receita-servicos" placeholder="0.00" step="0.01">
                        </div>
                        
                        <div class="form-group">
                            <label for="outras-receitas">OUTRAS RECEITAS (R$):</label>
                            <input type="number" id="outras-receitas" placeholder="0.00" step="0.01">
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>DESPESAS</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="custos-produtos">CUSTOS COM PRODUTOS (R$):</label>
                            <input type="number" id="custos-produtos" placeholder="0.00" step="0.01">
                        </div>
                        
                        <div class="form-group">
                            <label for="folha-pagamento">FOLHA DE PAGAMENTO (R$):</label>
                            <input type="number" id="folha-pagamento" placeholder="0.00" step="0.01">
                        </div>
                        
                        <div class="form-group">
                            <label for="aluguel">ALUGUEL (R$):</label>
                            <input type="number" id="aluguel" placeholder="0.00" step="0.01">
                        </div>
                        
                        <div class="form-group">
                            <label for="contas-publicas">CONTAS PÚBLICAS (R$):</label>
                            <input type="number" id="contas-publicas" placeholder="0.00" step="0.01">
                        </div>
                        
                        <div class="form-group">
                            <label for="marketing">MARKETING (R$):</label>
                            <input type="number" id="marketing" placeholder="0.00" step="0.01">
                        </div>
                        
                        <div class="form-group">
                            <label for="outras-despesas">OUTRAS DESPESAS (R$):</label>
                            <input type="number" id="outras-despesas" placeholder="0.00" step="0.01">
                        </div>
                    </div>
                </div>
                
                <button class="btn-gerar" onclick="gerarRelatorio()">GERAR RELATÓRIO PDF</button>
                
                <div class="preview-section">
                    <h3>PRÉ-VISUALIZAÇÃO DOS RESULTADOS</h3>
                    
                    <div class="resultados">
                        <div class="resultado-card">
                            <h3>RECEITA TOTAL</h3>
                            <div class="resultado-valor" id="preview-receita">R$ 0,00</div>
                            <p>Soma de todas as receitas do período</p>
                        </div>
                        
                        <div class="resultado-card">
                            <h3>DESPESA TOTAL</h3>
                            <div class="resultado-valor" id="preview-despesa">R$ 0,00</div>
                            <p>Soma de todas as despesas do período</p>
                        </div>
                        
                        <div class="resultado-card">
                            <h3>FLUXO DE CAIXA LÍQUIDO</h3>
                            <div class="resultado-valor" id="preview-liquido">R$ 0,00</div>
                            <p>Receitas menos despesas</p>
                        </div>
                        
                        <div class="resultado-card">
                            <h3>MARGEM LÍQUIDA</h3>
                            <div class="resultado-valor" id="preview-margem">0%</div>
                            <p>Porcentagem do lucro em relação à receita</p>
                        </div>
                    </div>
                    
                    <h4>DISTRIBUIÇÃO DE DESPESAS</h4>
                    <div class="chart-container">
                        <canvas id="despesasChart"></canvas>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <footer>
        <p>Para serviço personalizado, entre em contato pelo WhatsApp:<br>
        <strong>Juliana Batista - (88) 98831-4077</strong></p>
    </footer>
    
    <script>
        // Inicializa o gráfico de despesas
        let despesasChart;
        
        function atualizarPreview() {
            // Calcula totais
            const receitaVendas = parseFloat(document.getElementById('receita-vendas').value) || 0;
            const receitaServicos = parseFloat(document.getElementById('receita-servicos').value) || 0;
            const outrasReceitas = parseFloat(document.getElementById('outras-receitas').value) || 0;
            
            const custosProdutos = parseFloat(document.getElementById('custos-produtos').value) || 0;
            const folhaPagamento = parseFloat(document.getElementById('folha-pagamento').value) || 0;
            const aluguel = parseFloat(document.getElementById('aluguel').value) || 0;
            const contasPublicas = parseFloat(document.getElementById('contas-publicas').value) || 0;
            const marketing = parseFloat(document.getElementById('marketing').value) || 0;
            const outrasDespesas = parseFloat(document.getElementById('outras-despesas').value) || 0;
            
            const receitaTotal = receitaVendas + receitaServicos + outrasReceitas;
            const despesaTotal = custosProdutos + folhaPagamento + aluguel + contasPublicas + marketing + outrasDespesas;
            const fluxoLiquido = receitaTotal - despesaTotal;
            const margemLiquida = receitaTotal > 0 ? ((fluxoLiquido / receitaTotal) * 100).toFixed(2) : 0;
            
            // Atualiza os valores na pré-visualização
            document.getElementById('preview-receita').textContent = formatarMoeda(receitaTotal);
            document.getElementById('preview-despesa').textContent = formatarMoeda(despesaTotal);
            
            const liquidoElement = document.getElementById('preview-liquido');
            liquidoElement.textContent = formatarMoeda(fluxoLiquido);
            liquidoElement.className = fluxoLiquido >= 0 ? 'resultado-valor positivo' : 'resultado-valor negativo';
            
            const margemElement = document.getElementById('preview-margem');
            margemElement.textContent = margemLiquida + '%';
            margemElement.className = margemLiquida >= 0 ? 'resultado-valor positivo' : 'resultado-valor negativo';
            
            // Atualiza o gráfico de despesas
            atualizarGraficoDespesas(custosProdutos, folhaPagamento, aluguel, contasPublicas, marketing, outrasDespesas);
        }
        
        function formatarMoeda(valor) {
            return 'R$ ' + valor.toFixed(2).replace('.', ',').replace(/(\d)(?=(\d{3})+\,)/g, '$1.');
        }
        
        function atualizarGraficoDespesas(custosProdutos, folhaPagamento, aluguel, contasPublicas, marketing, outrasDespesas) {
            const ctx = document.getElementById('despesasChart').getContext('2d');
            
            // Destrói o gráfico anterior se existir
            if (despesasChart) {
                despesasChart.destroy();
            }
            
            despesasChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Custos com Produtos', 'Folha de Pagamento', 'Aluguel', 'Contas Públicas', 'Marketing', 'Outras Despesas'],
                    datasets: [{
                        data: [custosProdutos, folhaPagamento, aluguel, contasPublicas, marketing, outrasDespesas],
                        backgroundColor: [
                            '#3498db',
                            '#2ecc71',
                            '#e74c3c',
                            '#f39c12',
                            '#9b59b6',
                            '#1abc9c'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${formatarMoeda(value)} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function gerarRelatorio() {
            // Obtém os valores do formulário
            const nomeEmpresa = document.getElementById('nome-empresa').value || "Sua Empresa";
            const periodo = document.getElementById('periodo-analise').value || 1;
            
            const receitaVendas = parseFloat(document.getElementById('receita-vendas').value) || 0;
            const receitaServicos = parseFloat(document.getElementById('receita-servicos').value) || 0;
            const outrasReceitas = parseFloat(document.getElementById('outras-receitas').value) || 0;
            
            const custosProdutos = parseFloat(document.getElementById('custos-produtos').value) || 0;
            const folhaPagamento = parseFloat(document.getElementById('folha-pagamento').value) || 0;
            const aluguel = parseFloat(document.getElementById('aluguel').value) || 0;
            const contasPublicas = parseFloat(document.getElementById('contas-publicas').value) || 0;
            const marketing = parseFloat(document.getElementById('marketing').value) || 0;
            const outrasDespesas = parseFloat(document.getElementById('outras-despesas').value) || 0;
            
            // Calcula totais
            const receitaTotal = receitaVendas + receitaServicos + outrasReceitas;
            const despesaTotal = custosProdutos + folhaPagamento + aluguel + contasPublicas + marketing + outrasDespesas;
            const fluxoLiquido = receitaTotal - despesaTotal;
            const margemLiquida = receitaTotal > 0 ? ((fluxoLiquido / receitaTotal) * 100).toFixed(2) : 0;
            
            // Cria o PDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Adiciona logo ou título
            doc.setFontSize(20);
            doc.setTextColor(40, 40, 40);
            doc.text('RELATÓRIO DE FLUXO DE CAIXA', 105, 20, { align: 'center' });
            
            doc.setFontSize(14);
            doc.text(`Empresa: ${nomeEmpresa}`, 15, 35);
            doc.text(`Período de análise: ${periodo} ${periodo > 1 ? 'meses' : 'mês'}`, 15, 45);
            
            // Adiciona data atual
            const dataAtual = new Date().toLocaleDateString('pt-BR');
            doc.text(`Data do relatório: ${dataAtual}`, 15, 55);
            
            // Linha divisória
            doc.setDrawColor(200, 200, 200);
            doc.line(15, 60, 195, 60);
            
            // Resumo executivo
            doc.setFontSize(16);
            doc.text('RESUMO EXECUTIVO', 15, 70);
            
            doc.setFontSize(12);
            doc.text(`Receita Total: ${formatarMoedaPDF(receitaTotal)}`, 15, 80);
            doc.text(`Despesa Total: ${formatarMoedaPDF(despesaTotal)}`, 15, 90);
            
            doc.setFontSize(14);
            doc.setTextColor(fluxoLiquido >= 0 ? 39 : 231, fluxoLiquido >= 0 ? 174 : 76, fluxoLiquido >= 0 ? 96 : 60);
            doc.text(`Fluxo de Caixa Líquido: ${formatarMoedaPDF(fluxoLiquido)}`, 15, 100);
            
            doc.setTextColor(fluxoLiquido >= 0 ? 39 : 231, fluxoLiquido >= 0 ? 174 : 76, fluxoLiquido >= 0 ? 96 : 60);
            doc.text(`Margem Líquida: ${margemLiquida}%`, 15, 110);
            
            // Detalhamento de receitas
            doc.setFontSize(16);
            doc.setTextColor(40, 40, 40);
            doc.text('DETALHAMENTO DE RECEITAS', 15, 125);
            
            doc.setFontSize(12);
            doc.text(`Receita de Vendas: ${formatarMoedaPDF(receitaVendas)}`, 15, 135);
            doc.text(`Receita de Serviços: ${formatarMoedaPDF(receitaServicos)}`, 15, 145);
            doc.text(`Outras Receitas: ${formatarMoedaPDF(outrasReceitas)}`, 15, 155);
            
            // Detalhamento de despesas
            doc.setFontSize(16);
            doc.text('DETALHAMENTO DE DESPESAS', 15, 170);
            
            doc.setFontSize(12);
            doc.text(`Custos com Produtos: ${formatarMoedaPDF(custosProdutos)}`, 15, 180);
            doc.text(`Folha de Pagamento: ${formatarMoedaPDF(folhaPagamento)}`, 15, 190);
            doc.text(`Aluguel: ${formatarMoedaPDF(aluguel)}`, 15, 200);
            doc.text(`Contas Públicas: ${formatarMoedaPDF(contasPublicas)}`, 15, 210);
            doc.text(`Marketing: ${formatarMoedaPDF(marketing)}`, 15, 220);
            doc.text(`Outras Despesas: ${formatarMoedaPDF(outrasDespesas)}`, 15, 230);
            
            // Adiciona nova página para gráficos (opcional)
            doc.addPage();
            doc.setFontSize(16);
            doc.text('VISUALIZAÇÃO GRÁFICA', 105, 20, { align: 'center' });
            
            // Adiciona o gráfico de pizza de despesas (simplificado)
            // Nota: Em um ambiente real, você pode querer usar canvas.toDataURL() e doc.addImage()
            // Aqui estamos apenas representando o conceito
            
            doc.setFontSize(12);
            doc.text('Distribuição de Despesas:', 15, 40);
            
            const despesas = [
                { nome: 'Custos com Produtos', valor: custosProdutos, cor: '#3498db' },
                { nome: 'Folha de Pagamento', valor: folhaPagamento, cor: '#2ecc71' },
                { nome: 'Aluguel', valor: aluguel, cor: '#e74c3c' },
                { nome: 'Contas Públicas', valor: contasPublicas, cor: '#f39c12' },
                { nome: 'Marketing', valor: marketing, cor: '#9b59b6' },
                { nome: 'Outras Despesas', valor: outrasDespesas, cor: '#1abc9c' }
            ];
            
            let yPos = 60;
            despesas.forEach(item => {
                if (item.valor > 0) {
                    const porcentagem = despesaTotal > 0 ? (item.valor / despesaTotal * 100).toFixed(1) : 0;
                    doc.setTextColor(40, 40, 40);
                    doc.text(`${item.nome}: ${formatarMoedaPDF(item.valor)} (${porcentagem}%)`, 20, yPos);
                    yPos += 10;
                }
            });
            
            // Recomendações
            doc.setFontSize(16);
            doc.text('RECOMENDAÇÕES', 15, yPos + 10);
            
            doc.setFontSize(12);
            if (fluxoLiquido > 0) {
                doc.text('Seu negócio está com fluxo de caixa positivo. Recomendamos:', 15, yPos + 20);
                doc.text('- Investir em expansão ou melhorias', 20, yPos + 30);
                doc.text('- Criar uma reserva financeira para emergências', 20, yPos + 40);
            } else {
                doc.text('Seu negócio está com fluxo de caixa negativo. Recomendamos:', 15, yPos + 20);
                doc.text('- Revisar e reduzir despesas não essenciais', 20, yPos + 30);
                doc.text('- Buscar aumentar as receitas através de promoções ou novos serviços', 20, yPos + 40);
                doc.text('- Negociar prazos com fornecedores', 20, yPos + 50);
            }
            
            // Salva o PDF
            doc.save(`Relatorio-Fluxo-Caixa-${nomeEmpresa.replace(/\s+/g, '-')}.pdf`);
        }
        
        function formatarMoedaPDF(valor) {
            return 'R$ ' + valor.toFixed(2).replace('.', ',');
        }
        
        // Adiciona listeners para atualização em tempo real
        document.addEventListener('DOMContentLoaded', function() {
            // Atualiza preview inicial
            atualizarPreview();
            
            // Adiciona listeners para todos os campos
            const campos = [
                'nome-empresa', 'periodo-analise', 
                'receita-vendas', 'receita-servicos', 'outras-receitas',
                'custos-produtos', 'folha-pagamento', 'aluguel', 
                'contas-publicas', 'marketing', 'outras-despesas'
            ];
            
            campos.forEach(id => {
                document.getElementById(id).addEventListener('input', atualizarPreview);
                document.getElementById(id).addEventListener('change', atualizarPreview);
            });
        });
    </script>
</body>
</html>
